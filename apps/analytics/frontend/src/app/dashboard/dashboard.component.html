<div class="dashboard">
  <!-- Tab Navigation -->
  <div class="tabs">
    <button
      [class.active]="activeTab === 'overview'"
      (click)="setActiveTab('overview')"
    >
      Overview
    </button>
    <button
      [class.active]="activeTab === 'finances'"
      (click)="setActiveTab('finances')"
    >
      Finances
    </button>
    <button
      [class.active]="activeTab === 'reservations'"
      (click)="setActiveTab('reservations')"
    >
      Reservations
    </button>
    <button
      [class.active]="activeTab === 'rooms'"
      (click)="setActiveTab('rooms')"
    >
      Rooms
    </button>
    <button
      [class.active]="activeTab === 'users'"
      (click)="setActiveTab('users')"
    >
      Users
    </button>
  </div>

  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <h2>{{ activeTitle }}</h2>
    <div class="dashboard-actions">
      <!-- Room selector - show only for rooms tab -->
      <div
        class="room-selector"
        *ngIf="activeTab === 'rooms' && roomsData.length > 0"
      >
        <label for="roomSelect">Select Room:</label>
        <select id="roomSelect" (change)="selectRoom($event)">
          <option [value]="''">Average - All Rooms</option>
          <option *ngFor="let room of roomsData" [value]="room.roomId">
            {{ room.roomName || "Unknown Room" }}
          </option>
        </select>
      </div>

      <!-- Filters for Users -->
      <div class="user-filters" *ngIf="activeTab === 'users'">
        <div class="filters-container">
          <div class="filter-row">
            <!-- Filter by role -->
            <div class="filter-group">
              <label for="userRoleSelect">Role:</label>
              <select id="userRoleSelect" (change)="onUserRoleFilterChange($event)">
                <option value="all">All</option>
                <option value="user">User</option>
                <option value="trainer">Trainer</option>
              </select>
            </div>

            <!-- Filter by state -->
            <div class="filter-group">
              <label for="userStateSelect">Status:</label>
              <select id="userStateSelect" (change)="onUserStateFilterChange($event)">
                <option value="all">All</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>

            <!-- Filter by sex -->
            <div class="filter-group">
              <label for="userSexSelect">Gender:</label>
              <select id="userSexSelect" (change)="onUserSexFilterChange($event)">
                <option value="all">All</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            </div>

            <!-- Filter by age group -->
            <div class="filter-group">
              <label for="userAgeGroupSelect">Age Group:</label>
              <select id="userAgeGroupSelect" (change)="onUserAgeGroupFilterChange($event)">
                <option value="all">All</option>
                <option value="15-18">15-18</option>
                <option value="18-26">18-26</option>
                <option value="26-30">26-30</option>
                <option value="30-40">30-40</option>
                <option value="40-50">40-50</option>
                <option value="50-65">50-65</option>
                <option value="65+">65+</option>
              </select>
            </div>

            <!-- Filter by registration date -->
            <div class="filter-group">
              <label for="userRegistrationTimeSelect">Registration Date:</label>
              <select id="userRegistrationTimeSelect" (change)="onUserRegistrationTimeFilterChange($event)">
                <option value="all">All Time</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
                <option value="year">This Year</option>
              </select>
            </div>

            <!-- Filter by last updated date -->
            <div class="filter-group">
              <label for="userLastUpdatedTimeSelect">Last Updated:</label>
              <select id="userLastUpdatedTimeSelect" (change)="onUserLastUpdatedTimeFilterChange($event)">
                <option value="all">All Time</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
                <option value="year">This Year</option>
              </select>
            </div>
            
            <!-- Reset filters button -->
            <div class="filter-group reset-button-container">
              <button class="reset-filters-button" (click)="resetUserFilters()">
                <span class="reset-icon">‚úï</span> Reset Filters
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- View toggle button - Don't show for overview tab -->
      <button *ngIf="activeTab !== 'overview'" (click)="toggleView()">
        Switch to {{ viewMode === "chart" ? "Table" : "Chart" }} View
      </button>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content">
    <!-- Overview View - Special Case -->
    <div *ngIf="activeTab === 'overview'" class="overview-cards">
      <!-- Financial Summary Card -->
      <div class="summary-card">
        <div class="card-header">
          <h3>Financial Summary</h3>
          <span class="card-icon">üí∞</span>
        </div>
        <div class="card-content">
          <div class="metric">
            <span class="metric-value"
              >{{ getLatestFinanceValue() | number : "1.0-0" }}$</span
            >
            <span class="metric-label">Latest Monthly Revenue</span>
          </div>
          <div class="metric">
            <span class="metric-value"
              >{{ getTotalFinanceValue() | number : "1.0-0" }}$</span
            >
            <span class="metric-label">Total Revenue YTD</span>
          </div>
        </div>
      </div>

      <!-- Reservations Summary Card -->
      <div class="summary-card">
        <div class="card-header">
          <h3>Reservations</h3>
          <span class="card-icon">üìÖ</span>
        </div>
        <div class="card-content">
          <div class="metric">
            <span class="metric-value">{{ getLatestReservationsValue() }}</span>
            <span class="metric-label">Latest Monthly Bookings</span>
          </div>
          <div class="metric">
            <span class="metric-value">{{ getTotalReservationsValue() }}</span>
            <span class="metric-label">Total Bookings YTD</span>
          </div>
        </div>
      </div>

      <!-- Room Occupancy Summary Card -->
      <div class="summary-card">
        <div class="card-header">
          <h3>Room Occupancy</h3>
          <span class="card-icon">üè¢</span>
        </div>
        <div class="card-content">
          <div class="metric">
            <span class="metric-value"
              >{{ getAverageRoomOccupancyValue() }}%</span
            >
            <span class="metric-label">Average Occupancy Rate</span>
          </div>
          <div class="metric">
            <span class="metric-value"
              >{{ getHighestOccupancyRoom().value }}%</span
            >
            <span class="metric-label"
              >Highest: {{ getHighestOccupancyRoom().name }}</span
            >
          </div>
        </div>
      </div>

      <!-- Users Card -->
      <div class="summary-card">
        <div class="card-header">
          <h3>Users and Trainers</h3>
          <span class="card-icon">üë•</span>
        </div>
        <div class="card-content">
          <div *ngIf="isUsersLoading" class="loading-indicator">
            <p>Loading data...</p>
          </div>
          <div *ngIf="usersError" class="error-message">
            <p>{{ usersError }}</p>
          </div>
          <div *ngIf="!isUsersLoading && !usersError">
            <div class="metric">
              <span class="metric-value">{{ getTotalUsersCount() }}</span>
              <span class="metric-label">Total Users</span>
            </div>
            <div class="metric">
              <span class="metric-value">{{ getActiveUsersCount() }}</span>
              <span class="metric-label">Active Users</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chart View - For non-overview tabs -->
    <div
      *ngIf="viewMode === 'chart' && activeTab !== 'overview'"
      class="chart-view"
    >
      <div class="chart-placeholder">
        <!-- Loading indicator for users tab -->
        <div *ngIf="activeTab === 'users' && isUsersLoading" class="loading-indicator">
          <p>Loading data...</p>
        </div>
        
        <!-- Error message for users tab -->
        <div *ngIf="activeTab === 'users' && usersError" class="error-message">
          <p>{{ usersError }}</p>
        </div>

        <!-- Information about empty data for users tab with no error -->
        <div *ngIf="activeTab === 'users' && !isUsersLoading && !usersError && activeData.length === 0" class="empty-data-message">
          <p>No data found for the selected filters.</p>
        </div>

        <!-- Information about empty data for future implementation -->
        <div *ngIf="activeTab !== 'users' && activeData.length === 0" class="empty-data-message">
          <p>Data for {{ activeTab }} will be implemented soon.</p>
        </div>

        <!-- Multiple charts for users tab -->
        <div *ngIf="activeTab === 'users' && !isUsersLoading && !usersError" class="charts-container">
          <!-- Chart for user roles distribution -->
          <div class="chart-section">
            <h3 class="chart-title">Role Distribution</h3>
            <div class="chart-grid">
              <div class="y-axis">
                <div class="y-label" *ngFor="let value of roleChartYAxis">
                  {{ value }}
                </div>
              </div>
              <div class="mock-chart">
                <div
                  *ngFor="let item of roleChartData"
                  class="chart-bar"
                  [style.height.px]="getBarHeight(item.value, roleChartYAxis[0])"
                >
                  <span class="bar-value">{{ item.value }}</span>
                  <span class="tooltip">{{ item.label }}: {{ item.value }}</span>
                  <span class="bar-label">{{ item.label }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Chart for user status distribution -->
          <div class="chart-section">
            <h3 class="chart-title">Status Distribution</h3>
            <div class="chart-grid">
              <div class="y-axis">
                <div class="y-label" *ngFor="let value of statusChartYAxis">
                  {{ value }}
                </div>
              </div>
              <div class="mock-chart">
                <div
                  *ngFor="let item of statusChartData"
                  class="chart-bar"
                  [style.height.px]="getBarHeight(item.value, statusChartYAxis[0])"
                >
                  <span class="bar-value">{{ item.value }}</span>
                  <span class="tooltip">{{ item.label }}: {{ item.value }}</span>
                  <span class="bar-label">{{ item.label }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Chart for gender distribution -->
          <div class="chart-section">
            <h3 class="chart-title">Gender Distribution</h3>
            <div class="chart-grid">
              <div class="y-axis">
                <div class="y-label" *ngFor="let value of genderChartYAxis">
                  {{ value }}
                </div>
              </div>
              <div class="mock-chart">
                <div
                  *ngFor="let item of genderChartData"
                  class="chart-bar"
                  [style.height.px]="getBarHeight(item.value, genderChartYAxis[0])"
                >
                  <span class="bar-value">{{ item.value }}</span>
                  <span class="tooltip">{{ item.label }}: {{ item.value }}</span>
                  <span class="bar-label">{{ item.label }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Chart for age group distribution -->
          <div class="chart-section">
            <h3 class="chart-title">Age Group Distribution</h3>
            <div class="chart-grid">
              <div class="y-axis">
                <div class="y-label" *ngFor="let value of ageGroupChartYAxis">
                  {{ value }}
                </div>
              </div>
              <div class="mock-chart">
                <div
                  *ngFor="let item of ageGroupChartData"
                  class="chart-bar"
                  [style.height.px]="getBarHeight(item.value, ageGroupChartYAxis[0])"
                >
                  <span class="bar-value">{{ item.value }}</span>
                  <span class="tooltip">{{ item.label }}: {{ item.value }}</span>
                  <span class="bar-label">{{ item.label }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Chart for registration month distribution -->
          <div class="chart-section">
            <h3 class="chart-title">Registration by Month</h3>
            <div class="chart-grid">
              <div class="y-axis">
                <div class="y-label" *ngFor="let value of registrationChartYAxis">
                  {{ value }}
                </div>
              </div>
              <div class="mock-chart">
                <div
                  *ngFor="let item of registrationChartData"
                  class="chart-bar"
                  [style.height.px]="getBarHeight(item.value, registrationChartYAxis[0])"
                >
                  <span class="bar-value">{{ item.value }}</span>
                  <span class="tooltip">{{ item.label }}: {{ item.value }}</span>
                  <span class="bar-label">{{ item.label }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Original chart grid - only shown when there's data for non-users tab -->
        <div class="chart-grid" *ngIf="activeTab !== 'users' && activeData.length > 0">
          <!-- Y-osa s hodnotami -->
          <div class="y-axis">
            <div class="y-label" *ngFor="let value of yAxisValues">
              {{ value }}
            </div>
          </div>

          <!-- Graf -->
          <div class="mock-chart">
            <div
              *ngFor="let item of activeData"
              class="chart-bar"
              [style.height.px]="getBarHeight(item.value)"
            >
              <!-- Hodnota nad sloupcem -->
              <span class="bar-value">
                {{ item.value }}{{ activeTab === "rooms" ? "%" : "" }}
              </span>
              <span class="tooltip"
                >{{ item.date }}: {{ item.value
                }}{{ activeTab === "rooms" ? "%" : "" }}</span
              >
              <!-- Popisek pod sloupcem -->
              <span class="bar-label">{{ item.date }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Table View - For non-overview tabs -->
    <div
      *ngIf="viewMode === 'table' && activeTab !== 'overview'"
      class="table-view"
    >
      <!-- Loading indicator for users tab -->
      <div *ngIf="activeTab === 'users' && isUsersLoading" class="loading-indicator">
        <p>Loading data...</p>
      </div>
      
      <!-- Error message for users tab -->
      <div *ngIf="activeTab === 'users' && usersError" class="error-message">
        <p>{{ usersError }}</p>
      </div>

      <!-- Information about empty data for users tab with no error -->
      <div *ngIf="activeTab === 'users' && !isUsersLoading && !usersError && usersTableData.length === 0" class="empty-data-message">
        <p>No data found for the selected filters.</p>
      </div>

      <!-- Information about empty data for future implementation -->
      <div *ngIf="activeTab !== 'users' && activeData.length === 0" class="empty-data-message">
        <p>Data for {{ activeTab }} will be implemented soon.</p>
      </div>

      <!-- Standard Table - for non-users tabs -->
      <table *ngIf="activeTab !== 'users' && activeData.length > 0">
        <thead>
          <tr>
            <th>Date</th>
            <th>{{ valueLabel }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of activeData">
            <td>{{ item.date }}</td>
            <td>{{ item.value }}{{ activeTab === "rooms" ? "%" : "" }}</td>
          </tr>
        </tbody>
      </table>

      <!-- Users Detailed Table -->
      <table *ngIf="activeTab === 'users' && usersTableData.length > 0" class="users-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Role</th>
            <th>Status</th>
            <th>Gender</th>
            <th>Weight (kg)</th>
            <th>Height (cm)</th>
            <th>BMI</th>
            <th>Birth Date</th>
            <th>Age</th>
            <th>Registered</th>
            <th>Last Updated</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of usersTableData">
            <td>{{ user.id }}</td>
            <td>{{ formatRole(user.roleId) }}</td>
            <td [class]="'status-' + user.state">{{ formatState(user.state) }}</td>
            <td>{{ formatSex(user.sex) }}</td>
            <td>{{ user.weight }}</td>
            <td>{{ user.height }}</td>
            <td [class]="getBMIClass(calculateBMI(user.weight, user.height))">{{ formatBMI(calculateBMI(user.weight, user.height)) }}</td>
            <td>{{ formatDate(user.birthDate) }}</td>
            <td>{{ calculateAge(user.birthDate) }}</td>
            <td>{{ formatDate(user.createdAt) }}</td>
            <td>{{ formatDate(user.lastUpdated) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
